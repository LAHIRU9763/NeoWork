package com.alaqahtml5.qa.neo3rdpartywebtests;

import org.testng.Assert;
import org.testng.annotations.Parameters;
import org.testng.annotations.Test;
import org.testng.asserts.SoftAssert;

import com.alaqahtml5.qa.base.TestUtilities;
import com.alaqahtml5.qa.pages.LNMyAccount;
import com.alaqahtml5.qa.pages.LandingAreaPage;
import com.alaqahtml5.qa.pages.LeftNavigationSlider;
import com.alaqahtml5.qa.pages.LoginPage;
import com.alaqahtml5.qa.pages.TadawulatyPage;

public class EdaaPageOpenTest extends TestUtilities {

	@Test(priority = 1)
	@Parameters({ "username", "password" })

	public void lnMyAccountTest(String username, String password) {

		SoftAssert softAssert = new SoftAssert();
		log.info("Starting logIn test");

		// open main page
		LoginPage loginPage = new LoginPage(driver, log);
		loginPage.openPage();

		// Verifications
		// New page url is expected
		softAssert.assertEquals(loginPage.getCurrentUrl(), loginPage.getPageUrl(),
				"not matching" + loginPage.getCurrentUrl() + "with" + loginPage.getPageUrl());

		sleep(7000);
		// execute log in
		loginPage.logIn(username, password);

		// calling Landing page
		LandingAreaPage landingAriaPAge = new LandingAreaPage(driver, log);

		landingAriaPAge.clickLoginInformationOkay();

		sleep(7000);

		LeftNavigationSlider leftNavigationSlider = new LeftNavigationSlider(driver, log);
		leftNavigationSlider.clickMyProfile();

		sleep(7000);

		LNMyAccount lNMyAccount = new LNMyAccount(driver, log);

		// click on Tadawulaty
		lNMyAccount.clickTadawulaty();

		TadawulatyPage newWindowPage = lNMyAccount.switchToNewWindowPage();

		String pageSource = newWindowPage.getCurrentPageSource();

		// Verification that new page contains expected text in source
		softAssert.assertTrue(pageSource.contains("Edaa"), "New page source doesn't contain expected text");
		// switching to previous tab
		switchToPreviousTab();

		softAssert.assertAll();

	}
}
